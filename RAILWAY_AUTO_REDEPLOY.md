# üöÄ Railway Auto-Redeploy System

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–¥–µ–ø–ª–æ—è Railway –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å 403 –æ—à–∏–±–∫–∞–º–∏ –æ—Ç Vinted –ø—É—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Railway, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–±—Ä–æ—Å–∏—Ç—å IP-–∞–¥—Ä–µ—Å –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

## ‚öôÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### üéØ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫**: –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Å–µ HTTP 403 –æ—à–∏–±–∫–∏ –æ—Ç Vinted API
2. **–ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**: –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –∏ –≤—Ä–µ–º—è —Å –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–∏
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–µ–ø–ª–æ–π**: –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —Ä–µ–¥–µ–ø–ª–æ–π Railway
4. **–°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫

### üìä –£—Å–ª–æ–≤–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–¥–µ–ø–ª–æ—è

- **–í—Ä–µ–º—è**: 4 –º–∏–Ω—É—Ç—ã —Å –ø–µ—Ä–≤–æ–π 403 –æ—à–∏–±–∫–∏
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫**: –ú–∏–Ω–∏–º—É–º 5 –æ—à–∏–±–æ–∫ 403 –ø–æ–¥—Ä—è–¥
- **–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞**: –ú–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç –º–µ–∂–¥—É —Ä–µ–¥–µ–ø–ª–æ—è–º–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Railway Project ID (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è)
RAILWAY_PROJECT_ID=101cc62f-b314-41d1-9b55-d58ae5c371ea

# Railway API Token (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è API –º–µ—Ç–æ–¥–∞)
RAILWAY_TOKEN=your_railway_token_here

# Railway Service ID (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è)
RAILWAY_SERVICE_ID=your_service_id
```

### 2. Railway CLI

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Railway CLI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Railway CLI
npm install -g @railway/cli

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
railway login

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
railway whoami
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Web Interface

–î–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: `/config`

**–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ 403 –æ—à–∏–±–æ–∫
- –í—Ä–µ–º—è –ø–µ—Ä–≤–æ–π –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏
- –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–¥–µ–ø–ª–æ—è
- –°—Ç–∞—Ç—É—Å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–¥–µ–ø–ª–æ—è

### API Endpoints

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã —Ä–µ–¥–µ–ø–ª–æ—è
GET /redeploy_status

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–¥–µ–ø–ª–æ–π
POST /force_redeploy
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ API

```json
{
  "error_403_count": 3,
  "first_403_time": "2025-08-06T15:30:00Z",
  "last_403_time": "2025-08-06T15:32:00Z",
  "last_redeploy_time": null,
  "redeploy_threshold_minutes": 4,
  "max_403_errors": 5,
  "time_since_first_403_seconds": 180,
  "redeploy_needed": false,
  "monitoring_available": true
}
```

## üîÑ –ú–µ—Ç–æ–¥—ã —Ä–µ–¥–µ–ø–ª–æ—è

### 1. Railway API (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç GraphQL API Railway –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ —Ä–µ–¥–µ–ø–ª–æ—è:

```graphql
mutation serviceRedeploy($serviceId: String!) {
  serviceRedeploy(serviceId: $serviceId) {
    id
  }
}
```

### 2. Railway CLI (Fallback)

–ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CLI –∫–æ–º–∞–Ω–¥—É:

```bash
railway redeploy --yes
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[REDEPLOY]`:

```
[REDEPLOY] First 403 error detected at 2025-08-06 15:30:00
[REDEPLOY] 403 error #3 detected at 2025-08-06 15:32:00
[REDEPLOY] Redeploy conditions met:
[REDEPLOY] - Time since first 403: 0:04:15
[REDEPLOY] - Total 403 errors: 5
[REDEPLOY] - Initiating automatic redeploy...
[REDEPLOY] ‚úÖ Railway redeploy initiated successfully!
```

## üõ†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥

### Requester Integration

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ `pyVintedVN/requester.py`:

```python
# –°–æ–æ–±—â–µ–Ω–∏–µ –æ 403 –æ—à–∏–±–∫–µ
if response.status_code == 403:
    report_403_error()

# –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
if response.status_code == 200:
    report_success()
```

### Manual Usage

```python
from railway_redeploy import report_403_error, report_success, get_redeploy_status

# –°–æ–æ–±—â–∏—Ç—å –æ 403 –æ—à–∏–±–∫–µ
report_403_error()

# –°–æ–æ–±—â–∏—Ç—å –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
report_success()

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å
status = get_redeploy_status()
```

## üö® Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–æ–∫–µ–Ω–æ–º Railway

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
railway whoami

# –ü–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
railway logout
railway login
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Service ID

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞
railway status

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
railway service list
```

### –û—Ç–ª–∞–¥–∫–∞

```python
# –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏
import logging
logging.getLogger('railway_redeploy').setLevel(logging.DEBUG)
```

## üìã –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

- `railway_redeploy.py` - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–¥–µ–ø–ª–æ—è
- `railway_config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `pyVintedVN/requester.py` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å HTTP requester
- `web_ui_plugin/web_ui.py` - API endpoints –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `web_ui_plugin/templates/config.html` - Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –î–æ–∂–¥–∏—Ç–µ—Å—å 403 –æ—à–∏–±–æ–∫ –æ—Ç Vinted
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π `[REDEPLOY]`
4. –û—Ç–∫—Ä–æ–π—Ç–µ `/config` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å–∞

### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç

```bash
# –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
curl -X POST http://localhost:5000/force_redeploy

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "Force Redeploy" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /config
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ 403 –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —á–∞—Å—Ç—ã—Ö —Ä–µ–¥–µ–ø–ª–æ–µ–≤
- ‚úÖ Fallback –º–µ—Ç–æ–¥—ã –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π